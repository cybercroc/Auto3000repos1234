/*! manyaScroll v0.4 manyasoft.com  prasoon*/
function setScroll(holder, mxH) {
    resetScroll(holder);
    if ($(holder).height() > mxH) {
        $(holder).height(mxH);
    }

    $(holder).wrapInner('<div class="scrollBox"> </div>');
    scrollBox = $(holder).find('.scrollBox');
    holderH = $(holder).height();
    contentH = $(scrollBox).height();

    if (contentH > holderH) {
        $(holder).height(mxH);
        $(holder).css({
            'position': 'relative'
        });
        $(scrollBox).css({
            'position': 'absolute'
        });
        $(holder).append('<div class="scrollTrack"><div class="scrollBar" style="top: 0px;"></div></div>');
        $(holder).find('.scrollTrack').height(mxH);
        sh = Math.round((mxH * ((mxH * 100) / contentH)) / 100);
        $(holder).find('.scrollBar').height(sh);
        $(holder).find('.scrollBar').draggable({
            axis: "y",
            containment: "parent",
            cursorAt: {
                 top: sh / 2
            },
            drag: function () {
                dragIt(this);
            }
        });
    }
};

function resetScroll(holder) {
    $(holder).removeAttr('style');
    $(holder).find('.scrollBox').replaceWith($(holder).find('.scrollBox').html());
    $(holder).find('.scrollTrack').remove();
};

function dragIt(bar) {
    scrollHolder = $(bar).parent().parent();
    scrollContent = $(scrollHolder).find('.scrollBox');
    hiddenArea = $(scrollContent).height() - $(scrollHolder).height();
    scrollArea = $(scrollHolder).find('.scrollTrack').height() - $(bar).height();
    barPosition = $(bar).position().top
    scrollPosition = (hiddenArea * ((barPosition * 100) / scrollArea)) / 100;
    $(scrollContent).css({
        'top': (scrollPosition * -1)
    });
};

function mouseRoll(e) {
    if (e.wheelDelta) {
        mDirection = (e.wheelDelta / 120);
    } else if (e.detail) {
        mDirection = (e.detail / -3);
    }
				scMove = 20;
    if (mDirection > 0) {
        moveDown();
    } else if (mDirection < 0) {
        moveUp();
    }

    setBarPosition = (($(cScrllHold).find('.scrollTrack').height() - $(cScrllHold).find('.scrollBar').height()) * (($(cScrllBox).position().top * -100) / maxTop)) / 100;
    $(cScrllHold).find('.scrollBar').css({
        'top': setBarPosition
    });
    e.preventDefault();
    return false;
}

$('.scrollBox').live('mouseenter', function () {
    cScrllHold = $(this).parent();
    cScrllId = $(cScrllHold).attr('id');
    cScrllBox = $(cScrllHold).find('.scrollBox');
    maxTop = $(cScrllBox).height() - $(cScrllHold).height();
    scroller = document.getElementById(cScrllId);
    if (window.addEventListener) {
        scroller.addEventListener('DOMMouseScroll', mouseRoll, false);
    }
    scroller.onmousewheel = mouseRoll;
});

function moveUp() {
    if ($(cScrllBox).position().top > maxTop * -1) {
					if(($(cScrllBox).position().top - (maxTop * -1)) < scMove ){ scMove = ($(cScrllBox).position().top - (maxTop * -1)) }// else {scMove = 20;}
        $('#' + cScrllId).find('.scrollBox').css({
            top: ($(cScrllBox).position().top - scMove)
        });
    }
};

function moveDown() {
	//alert($(cScrllBox).position().top);
					if(($(cScrllBox).position().top < -scMove) && ($(cScrllBox).position().top < 0)){
						$('#' + cScrllId).find('.scrollBox').css({
            top: ($(cScrllBox).position().top + scMove)
        });
						}
					else if(($(cScrllBox).position().top >= -scMove) && ($(cScrllBox).position().top < 0)){ 
							$('#' + cScrllId).find('.scrollBox').css({top: 0});
					}
};
$('.scroll').live('mouseenter',function(){$(this).find('.scrollBar').fadeIn(300)});$('.scroll').live('mouseleave',function(){$(this).find('.scrollBar').fadeOut(300)});
